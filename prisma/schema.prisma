generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Book {
  id                String      @id @default(uuid())
  title             String
  author            String?
  isbn              String?     @unique
  category          String?
  status            BookStatus  @default(AVAILABLE)
  recognitionSource String?
  confidenceScore   Float?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  loans             Loan[]

  @@index([title])
}

enum BookStatus {
  AVAILABLE
  LOANED
}

model Loan {
  id              String     @id @default(uuid())
  bookId          String
  borrowerName    String
  borrowerContact String?
  loanDate        DateTime
  dueDate         DateTime
  returnDate      DateTime?
  status          LoanStatus @default(LOANED)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt

  book            Book       @relation(fields: [bookId], references: [id], onDelete: Cascade)

  @@index([bookId])
  @@index([dueDate])
}

enum LoanStatus {
  LOANED
  RETURNED
  OVERDUE
}

model VideoProcessing {
  id              String            @id @default(uuid())
  filename        String
  filepath        String
  filesize        Int
  mimeType        String
  status          ProcessingStatus  @default(PENDING)
  frameCount      Int?
  processedFrames Int?
  errorMessage    String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  ocrResults      OcrResult[]
}

enum ProcessingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

model OcrResult {
  id                String          @id @default(uuid())
  videoProcessingId String
  frameNumber       Int
  recognizedText    String
  confidenceScore   Float
  boundingBox       Json?
  language          String
  isBookTitle       Boolean         @default(false)
  createdAt         DateTime        @default(now())

  videoProcessing   VideoProcessing @relation(fields: [videoProcessingId], references: [id], onDelete: Cascade)

  @@index([videoProcessingId])
  @@index([confidenceScore])
}
